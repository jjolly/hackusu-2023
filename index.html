<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />

        <title>Rouge Like</title>

        <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    </head>

    
    <body style="background-color: skyblue;">
        <header style="">Rogue Like</header>

      <div class="wrapper">
        <div class="left-div">
          <span>Movement Controls:</span> 
          <hr>
          <span>w,a,s,d or Arrow keys</span>
        </div>
        <div id="game-background" style="background-color: black; white-space: pre;font-family: monospace; margin: auto;" py-onKeyDown="send_command">
          <p id="game-screen" style="color: white"></p>
        </div>
        <div class="right-div" style="white-space: pre;">
          <span id="stats" style="color: black"></span>
        </div>
      </div>

      <div>
        <textarea id="console"></textarea>
      </div>

        
        <py-config type="toml">
          [[fetch]]
          files = ["./game.py", "./room.py", "./creatures.py", "./items.py"]
      </py-config>

        <py-script>
            from pyscript import Element
            from pyodide.ffi import create_proxy
            from game import Game

            def onKeyPress(event):
                event.preventDefault();
                
                send_command(gameObject, event.key)



            def current_key(key):
                # Get paragraph element by id
                return key, 1


            def send_command(game, ch):
              cmd = {
                      'w': "UP",
                      'a': "LEFT",
                      's': "DOWN",
                      'd': "RIGHT",
                      'ArrowUp': "UP",
                      'ArrowLeft': "LEFT",
                      'ArrowDown': "DOWN",
                      'ArrowRight': "RIGHT"
                    }
              if ch in cmd:
                  game.sendCommand(cmd[ch])
                  draw_board(game, Element("game-screen"))
                  draw_stats(game, Element("stats"))
                  draw_messages(game, Element("console"))

            def draw_board(game, window):
              board = game.getBoard()
              stringBoard = ""
              for line in board:
                stringBoard += "\n" + line
              window.write(stringBoard)

            def draw_stats(game, window):
              playerStats = game.getStats()
              stringStats = ""
              for key in playerStats:
                value = playerStats[key]
                stringStats += "\n" + key + " : " + str(value)
              window.write(stringStats)

            def draw_messages(game, window):
              message = game.getMessages()
              window.write(message)
            

            gameObject = Game()
            draw_board(gameObject, Element("game-screen"))
            draw_stats(gameObject, Element("stats"))
            
            js.document.addEventListener('keydown', create_proxy(onKeyPress))
    
   
              

        </py-script>
    </body>
</html>
